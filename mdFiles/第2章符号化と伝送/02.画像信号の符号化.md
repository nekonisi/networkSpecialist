02.画像信号の符号化
===

## 画像符号化の基礎知識

- 画像データの符号化は，基本的に音声の場合と同じ処理を行う。
- 画像で重要になるのは，データ量の大きさである。
- 標準的な画像サイズである*フルHD*では，白黒の二値画像であっても2,073,600ビットの容量が必要である。
- これにRGBの色を付け，それぞれの輝度を256段階で表したとすれば6MG以上のデータとなる。
  - 動画では，こうした画像が1数十枚必要になる。

---

## 画像データの圧縮の手法

### 予測符号化

- 静止画のある点を観測すると、隣接したテント色相や輝度が類似していることが多いことがわかっている。
- 動画でもある一瞬と次の一瞬にはほとんど違いが見られない。
- 隣接した点と次の一瞬は現在の点と同じであるという予測のもとに、生じる変化を予測誤差として表す。
  - 予測誤差は現在のデータに対する差分として表せるため、必要なデータ量を抑制できる。

### 変換符号化(直交交換)

- 変換符号化では、隣接する画像をペアにして直交座標上にプロットする。
  - その後、座標軸を回転させて*エントロピ*が小さい値に変換する。

#### エントロピ

- 平均情報量のこと、情報量はその事象が起こりにくい場合に増加し、起こりやすい場合に減少する。
  - 画像データは隣接画素同士が同じようなデータになりやすいためエントロピは減少する。

### 不可逆符号化

- データ量を削減するため、データを間引く手法。
- 不可逆符号化を行うと、一般的にデータの精度は落ちる。
  - 人間工学的に違和感なく精度を落とすための工夫がされている。

### 動き補償予測

- 動画で行われる予測手法。
- 予測符号化を行っても動きの早い被写体が写っている場合は、予測誤差が大きくなってデータの精度は落ちる。
  - 動く物体が写っている画素をグループとして登録し、次の画像でその画素群がどこに移動しているかによって符号化を行う。

### エントロピ符号化

- 出現頻度の高いデータに短い符号を与えることでデータ量を削減する手法。
- どのような符号を付与すればデータ量を最小(*コンパクト符号*)にできるかは、ハフマン理論によって得ることができる。

---

## 画像データ規格

### JPEG

- DCTとハフマン符号を用いて画像を圧縮する。
- 高い圧縮率で写真を自然に復元できるという長所を持つ。
- 不可逆変換のため、写真のようなデータには適しているが画像に文字が含まれるデータにはにじみが生じる。

### GIF

- 可逆圧縮で文字やCGをきれいに再現できるのが特徴
- 色数は256色までしか扱えない。
  - アルゴリズムが特許権の問題に巻き込まれたため、PNGへの移行が進んだ。
- インターレースGIF(最初は荒い画像が表示され、データ転送が進むにれて高精度になる方)やアニメーションGIFがある。

### PNG

- GIFやJPEGよりも新しい静止画の規格。
- 後規格であるため、前世代の規格で扱いにくかった点が改良されている。
  - フルカラーが使える。
	- 可逆圧縮が可能
- ただし、アニメーションで扱うことができない。
- アニメーションを使用する場合は、APNGなどの拡張規格が必要になる。

### MPEG

- ISOが組織した動画規格策定委員会の名称で、そのまま画像規格の名前として使われている。
- 用途とビットレートに応じていくつかの規格が存在する。

#### ビットレート

- 単位時間あたりに転送または処理されるビット数。

|名称   |ビットレート      |用途|
|:-----:|:----------------:|:-----------------------------------------------------------------------------------------------:|
|MPEG-1 |1.5Mbps           |- VTR並の動画と音声を再生する目的で開発された。CD-ROMなどのメディアに保存されることを想定した規格|
|       |                  |- 規格は動画部分のMPEG-1ビデオ、音声部分のMPEG-1オーディオ、ビデオと音声の結合を定めたMPEG-1システムなどに分類され散る。|
|MPEG-2 |数M ~ 数十Mbps程度|- DVDなどの大容量メディアに保存したり、放送に用いることを想定した規格                            |
|       |                  |- そのため、複数の動画を配信するモードを有している。                                             |
|       |                  |- MPEG-1よりも広い用途に適合させるため、プロファイルとレベルという概念を持ち再生環境にあわせて   |
|       |                  |最適な圧縮方法を選択できるようになっている。                                                     |
|MPEG-4 |数十kbps ~        |- 通信速度の低い狭帯域回線でも利用できるよう、コストパフォーマンスを重視した規格                 |
|       |                  |- 絶対的な画質ではMPEG-1やMPEG-2に劣るが、低いビットレートの中で最大の品質が再現できるように     |
|       |                  |工夫がされている。                                                                               |
|       |                  |- 携帯電話やテレビ電話などで広く利用されている。                                                 |
|       |                  |- 携帯電話でストレスなく活用できるよう、伝送エラーに対応する処理が強化されている。               |
|MPEG-7 |-                 |- マルチメディア情報の属性を記述するために開発された標準規格。
|       |                  |- MPEG-7によって記述された属性情報を検索エンジンで検索することでコンテンツの管理が用意になる。   |
|MPEG-21|                  |- マルチメディア情報の著作権管理を行うための標準規格                                             |

#### MP3

- MPEG-1で採用されている音声圧縮方式。
- 最近ではMP3規格のみを取り出し、音楽配信フォーマットとして利用されている。

---

## 符号化したデータの伝送①同期制御

### 同期

- 通信を行う場合は、送信側と受信側でタイミングを合わせる必要がある。
  - これを*同期*と呼ぶ。
- 同期が取れていない状況で通信を行うと互いに認識しているデータが異なるものになる可能性がある。
- 同期のとり方は*ビット同期*と*ブロック同期*の二種類に大別できる。

#### ビット同期

- 1ビットのデータを正確に認識するための方法で、伝送される波形のどの部分が1ビットに対応するのかを規定する。
- 送信側と受信側でビット位置を正しく認識するためにタイミングクロックを使うため、*クロック同期方式*とも呼ばれる。

##### 同期方式

- 同期方式は、データ信号の中に、同期タイミングをとるための信号を混在させる方法である。
- 受信側は同期タイミングデータから、波形のどの部分をデータとして抽出できればよいか判断する。
- データの形によっては、同期タイミングを分離しにくいこともあり、その場合は、同期タイミング用の信号線をデータ信号線と別に用意する手法もあるがあまり利用されていない。

###### 調歩同期方式

- 非同期方式とも呼ばれる通信方式で、7ビットか8ビットの固定長ブロックの前後にスタートビットとストップビットを付加して送信する方式。
- 1文字ごとに2ビットの情報を付加しなければならないのでオーバーヘッドが大きく大容量のデータ伝送には不向き。
- 調歩同期方式で通信する場合は、以下の設定を送受信側で合わせる必要がある。
  - データブロックのサイズ(7bit or 8bit)
	- パリティの有無
	- 伝送速度
- 受信側は、スタートビットを検出した後は、伝送速度に従ってビット同期をとっていく。
- したがって、送信側と受信側のタイマ精度にずれがあると同期が取れない可能性がある。

---

### ブロック同期

- ビット同期が確立できたビット列を、データとして意味のあるブロックとして認識するための同期
- *キャラクタ同期*と*フラグ同期*がある。

#### キャラクタ同期方式

- 送信側が送信データの最初に*SYNコード*と呼ばれる同期をとるための特別なコードを連続して送信する方式。
- 同期方法が簡単で、ほとんどの通信機器が対応している。
- SYNコードは、`00010110`からなる8bitのビット列である。
- 受信側は、SYNコードを認識してから、データの受信を開始する。
- どのビットから受信を始めたとしても、最悪のケースでも8回目にはSYNコードを正しく認識して同期をとることができる。
- 8bitで構成されるテキストデータを送信するのに便利。

##### キャラクタ同期方式の欠点

- SYNコードのパターンはデータとして送信できない。
- 8bit長のデータしか送信できない。
  - 16bitで構成される日本語や可変長のマルチメディアデータの送信は不可能。

#### フラグ同期方式

- 送信したいデータの前後にフラグと呼ばれる特別なビット列を挿入して同期をとる。
- フラグに同じパターンが出てこなければよいので 、送信するデータは何ビット単位の固まりであってもかまわない。
- データの中にフラグと同じパターンが出てしまうと、フラグとして認識してしまうため、*セロインセーション*とよばれる処理を行う。
  - フラグ同期方式では、`011111110`というパターンをフラグとして使用するので、データの中に1が5津連続した場合は強制的に0を挿入する。
	- 受信側では、データ中で1が5津連続したら次に続く0を強制的に取り除く、この処理により、フラグの固有性を確保する。

----

## 符号化したデータの伝送②ベーシック手順

### ベーシック手順の概要

- IBMが開発したBSC方式をもとにISO/JIS化された伝送手順。

|項目            |値                            |
|:--------------:|:----------------------------:|
|同期方式        |キャラクタ同期方式            |
|伝送単位        |情報メッセージ単位            |
|伝送データの内訳|キャラクタ単位                |
|誤り制御        |水平垂直パリティ              |
|データリンク確立|コンテンション方式            |
|                |ボーリング/セレクティング方式|

### データ伝送のフェーズ

- ベーシック手順では、以下のフェーズによってデータ伝送を行う。

#### ベーシック手順の各フェーズ

1. 回線接続
1. データリンク確立
1. データの伝送
1. データリンクの切断
1. 回線の切断

##### 回線接続

- 交線回線におけるダイヤリング接続。
  - 専用線を使用している場合はこのフェーズは不要

##### データリンク確立

- `ENQシーケンス`とよばれる応答要求を送信してデータリンクの確立を行う。
- コンテンション方式と、ボーリング/セレクティング方式が用いられる。

##### コンテンション方式

- ポイントtoポイント接続で用いられるモードです。
- 1対1で接続されたノードは互いに対等な関係にあり、先にENQシーケンスを送信したノードが移行の通信の制御権を得る方式。

##### ボーリング/セレクティング方式

- ホストコンピュータに対して、複数の端末が接続することを念頭にしたモード
- ホストコンピュータが通信の制御券を持ち、*制御局*と呼ばれる。
  - t並松は*従属局*と呼ぶ。

###### ボーリング方式

- ボーリング方式は、制御局が従属局に対して送信したいデータがあるか問い合わせを行う。
- 従属局は送信すべきデータを保持していても、ボーリングされるまで送信を開始することができない。

###### セレクティング方式

- 制御局が従属局に対してデータを送信したい場合に取られる方式
- 一つの従属局を指名して、、送信の可否を尋ねる。

##### データの伝送

- データの伝送は情報メッセージ単位に行われるが、情報メッセージが長い場合は、ブロック分割する。
- ブロックの最後には`BCS`が追加されて誤り制御を行う。
  - BCS: Block Check Sequence
- このためブロック分割を行う単位が小さいとオーバーヘッドが増加する。

- データ伝送キャラクタとその説明

|伝送制御キャラクタ|説明              |
|:----------------:|:----------------:|
|`SYN`             |同期キャラクタ    |
|`ENQ`             |応答要求          |
|`ACK`             |肯定反応          |
|`NAK`             |否定応答          |
|`SOH`             |ヘディングスタート|
|`STX`             |テキストスタート  |
|`ETB`             |ブロック終了      |
|`ETX`             |テキスト終了      |
|`EOT`             |伝送終了          |
|`DLE`             |伝送制御拡張      |

###### データリンクの切断

- データの送信が終了したら、`EOT`を送信してデータリンクを切断する。

###### 回線の切断

- 回線を切断する。
